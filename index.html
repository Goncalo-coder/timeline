<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f7;
            padding: 10px;
            margin: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            margin-bottom: 10px;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="date"],
        input[type="color"],
        select {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 13px;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: #007AFF;
        }

        input[type="color"] {
            height: 36px;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 10px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #0051D5;
        }

        button.secondary {
            background: #f0f0f0;
            color: #333;
        }

        button.secondary:hover {
            background: #e0e0e0;
        }

        .timeline-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .timeline-card:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
        }

        .timeline-card.size-small {
            transform: scale(0.75);
            transform-origin: top center;
        }

        .timeline-card.size-medium {
            transform: scale(1);
        }

        .timeline-card.size-large {
            transform: scale(1.25);
            transform-origin: top center;
        }

        .size-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 122, 255, 0.1);
            color: #007AFF;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            pointer-events: none;
        }

        .timeline-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .timeline-title {
            font-size: 16px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .timeline-dates {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        .scale-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            padding: 0 5px;
            position: relative;
        }

        .scale-unit {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .scale-label {
            font-size: 11px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 3px;
        }

        .scale-date {
            font-size: 10px;
            color: #86868b;
        }

        .scale-separator {
            width: 1px;
            background: #e5e5e7;
            margin: 0 10px;
        }

        .timeline-bar-container {
            position: relative;
            margin: 10px 0;
        }

        .timeline-bar {
            height: 35px;
            background: #007AFF;
            border-radius: 18px;
            position: relative;
            overflow: hidden;
        }

        .timeline-separator {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 5;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .today-indicator {
            position: absolute;
            top: -8px;
            bottom: -30px;
            width: 2px;
            background: #FF3B30;
            box-shadow: 0 0 6px rgba(255, 59, 48, 0.4);
            transform: translateX(-50%);
            z-index: 10;
            animation: blink 2s ease-in-out infinite;
        }

        .today-label {
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: 600;
            color: #FF3B30;
            white-space: nowrap;
        }

        .timeline-endpoints {
            display: flex;
            justify-content: space-between;
            padding: 0 5px;
            margin-top: 8px;
        }

        .endpoint {
            font-size: 11px;
            color: #86868b;
            font-weight: 500;
        }

        .stats-section {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e5e7;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 10px;
            color: #86868b;
            font-weight: 500;
        }

        .share-section {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .share-label {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .share-input-group {
            display: flex;
            gap: 10px;
        }

        .share-input {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 11px;
            background: #f9f9f9;
            font-family: monospace;
        }

        .weekend {
            background: #f9f9fb;
        }

        @media (max-width: 768px) {
            .timeline-card {
                padding: 15px 10px;
            }

            .stats-section {
                flex-direction: column;
                gap: 15px;
            }

            .control-group {
                grid-template-columns: 1fr;
            }

            .scale-label {
                font-size: 10px;
            }

            .scale-date {
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="titleInput">Timeline Title</label>
                    <input type="text" id="titleInput" placeholder="My Project Timeline">
                </div>
                <div class="control-item">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" onkeydown="return false">
                </div>
                <div class="control-item">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" onkeydown="return false">
                </div>
                <div class="control-item">
                    <label for="scale">Scale</label>
                    <select id="scale">
                        <option value="daily">Daily (1-14 days)</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                    </select>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-item">
                    <label for="bgColor">Background Color</label>
                    <input type="color" id="bgColor" value="#f5f5f7">
                </div>
                <div class="control-item">
                    <label for="barColor">Timeline Bar Color</label>
                    <input type="color" id="barColor" value="#007AFF">
                </div>
                <div class="control-item">
                    <label for="todayColor">Today Line Color</label>
                    <input type="color" id="todayColor" value="#FF3B30">
                </div>
            </div>

            <div class="button-group">
                <button onclick="generateTimeline()">Generate Timeline</button>
                <button class="secondary" onclick="resetForm()">Reset</button>
            </div>
        </div>

        <div id="timelineDisplay" style="display: none;">
            <div class="timeline-card" id="timelineCard" onclick="cycleCardSize()">
                <div class="size-indicator" id="sizeIndicator">Medium</div>
                <div class="timeline-header">
                    <div class="timeline-title" id="displayTitle">Timeline Title</div>
                    <div class="timeline-dates" id="displayDates">Jan 1, 2024 - Dec 31, 2024</div>
                </div>

                <div class="scale-row" id="scaleRow"></div>

                <div class="timeline-bar-container">
                    <div class="timeline-bar" id="timelineBar"></div>
                    <div class="today-indicator" id="todayIndicator">
                        <div class="today-label">Today</div>
                    </div>
                </div>

                <div class="timeline-endpoints">
                    <div class="endpoint" id="startDateDisplay">Start</div>
                    <div class="endpoint" id="endDateDisplay">End</div>
                </div>

                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-value" id="totalUnits">0</div>
                        <div class="stat-label" id="totalUnitsLabel">Total Weeks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="percentComplete">0%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="unitsLeft">0</div>
                        <div class="stat-label" id="unitsLeftLabel">Weeks Left</div>
                    </div>
                </div>
            </div>

            <div class="share-section">
                <div class="share-label">Shareable Link</div>
                <div class="share-input-group">
                    <input type="text" class="share-input" id="shareUrl" readonly>
                    <button onclick="copyLink()">Copy Link</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse URL parameters on load
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('title')) {
                document.getElementById('titleInput').value = decodeURIComponent(params.get('title'));
                document.getElementById('startDate').value = params.get('start');
                document.getElementById('endDate').value = params.get('end');
                document.getElementById('scale').value = params.get('scale') || 'weekly';
                
                if (params.has('bgColor')) {
                    document.getElementById('bgColor').value = params.get('bgColor');
                }
                if (params.has('barColor')) {
                    document.getElementById('barColor').value = params.get('barColor');
                }
                if (params.has('todayColor')) {
                    document.getElementById('todayColor').value = params.get('todayColor');
                }
                
                generateTimeline();
            } else {
                // Set default dates
                const today = new Date();
                const threeMonthsLater = new Date(today);
                threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);
                
                document.getElementById('startDate').value = today.toISOString().split('T')[0];
                document.getElementById('endDate').value = threeMonthsLater.toISOString().split('T')[0];
            }
        });

        function generateTimeline() {
            const title = document.getElementById('titleInput').value || 'Timeline';
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const scale = document.getElementById('scale').value;
            const bgColor = document.getElementById('bgColor').value;
            const barColor = document.getElementById('barColor').value;
            const todayColor = document.getElementById('todayColor').value;

            if (isNaN(startDate) || isNaN(endDate)) {
                alert('Please select valid start and end dates');
                return;
            }

            if (startDate >= endDate) {
                alert('End date must be after start date');
                return;
            }

            // Apply colors
            document.body.style.background = bgColor;
            const timelineBar = document.getElementById('timelineBar');
            timelineBar.style.background = barColor;
            document.getElementById('todayIndicator').style.background = todayColor;
            document.querySelector('.today-label').style.color = todayColor;
            document.getElementById('todayIndicator').style.boxShadow = `0 0 6px ${todayColor}66`;

            // Update display
            document.getElementById('displayTitle').textContent = title;
            document.getElementById('displayDates').textContent = 
                `${formatDate(startDate)} - ${formatDate(endDate)}`;

            // Generate scale and separators
            generateScale(startDate, endDate, scale);

            // Calculate progress with time precision
            const today = new Date();
            
            let progress;
            if (scale === 'daily') {
                // For daily scale, use working hours: 8 AM (8) to 11 PM (23) = 15 hours
                const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                
                // Calculate which day we're in
                const todayMidnight = new Date(today);
                todayMidnight.setHours(0, 0, 0, 0);
                const daysPassed = Math.floor((todayMidnight - startDate) / (1000 * 60 * 60 * 24));
                
                // Calculate time within the current day (8 AM to 11 PM)
                const currentHour = today.getHours();
                const currentMinute = today.getMinutes();
                const currentSecond = today.getSeconds();
                
                // Convert to decimal hours from start of day
                const decimalHours = currentHour + (currentMinute / 60) + (currentSecond / 3600);
                
                // Calculate position within working hours (8 AM = 0, 11 PM = 15 hours)
                let hoursIntoWorkday;
                if (decimalHours < 8) {
                    // Before 8 AM - treat as start of workday
                    hoursIntoWorkday = 0;
                } else if (decimalHours > 23) {
                    // After 11 PM - treat as end of workday
                    hoursIntoWorkday = 15;
                } else {
                    // During working hours
                    hoursIntoWorkday = decimalHours - 8;
                }
                
                // Position within the current day (0 to 1)
                const dayProgress = hoursIntoWorkday / 15;
                
                // Total progress across all days
                progress = ((daysPassed + dayProgress) / totalDays) * 100;
            } else {
                // For other scales, use standard datetime calculation
                const totalMs = endDate - startDate;
                const msElapsed = today - startDate;
                progress = (msElapsed / totalMs) * 100;
            }
            
            progress = Math.max(0, Math.min(100, progress));
            document.getElementById('todayIndicator').style.left = progress + '%';

            // Update stats
            updateStats(startDate, endDate, today, scale);

            // Update endpoints
            document.getElementById('startDateDisplay').textContent = formatDate(startDate);
            document.getElementById('endDateDisplay').textContent = formatDate(endDate);

            // Generate shareable URL
            const url = new URL(window.location.href.split('?')[0]);
            url.searchParams.set('title', encodeURIComponent(title));
            url.searchParams.set('start', document.getElementById('startDate').value);
            url.searchParams.set('end', document.getElementById('endDate').value);
            url.searchParams.set('scale', scale);
            url.searchParams.set('bgColor', bgColor);
            url.searchParams.set('barColor', barColor);
            url.searchParams.set('todayColor', todayColor);

            document.getElementById('shareUrl').value = url.toString();

            // Show timeline
            document.getElementById('timelineDisplay').style.display = 'block';
            
            // Scroll to timeline
            setTimeout(() => {
                document.getElementById('timelineDisplay').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function generateScale(startDate, endDate, scale) {
            const scaleRow = document.getElementById('scaleRow');
            const barContainer = document.getElementById('timelineBar');
            scaleRow.innerHTML = '';
            barContainer.innerHTML = '';

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (scale === 'daily') {
                generateDailyScale(startDate, endDate, scaleRow, barContainer);
            } else if (scale === 'weekly') {
                generateWeeklyScale(startDate, endDate, scaleRow, barContainer);
            } else if (scale === 'monthly') {
                generateMonthlyScale(startDate, endDate, scaleRow, barContainer);
            } else if (scale === 'quarterly') {
                generateQuarterlyScale(startDate, endDate, scaleRow, barContainer);
            }
        }

        function generateDailyScale(startDate, endDate, scaleRow, barContainer) {
            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            
            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                // Create scale unit (centered between lines)
                const unit = document.createElement('div');
                unit.className = 'scale-unit';
                if (date.getDay() === 0 || date.getDay() === 6) {
                    unit.classList.add('weekend');
                }
                
                const label = document.createElement('div');
                label.className = 'scale-label';
                label.textContent = date.toLocaleDateString('en-US', { weekday: 'short' });
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'scale-date';
                dateLabel.textContent = date.getDate();
                
                unit.appendChild(label);
                unit.appendChild(dateLabel);
                scaleRow.appendChild(unit);
            }

            // Create separator lines (one less than scale units)
            for (let i = 1; i < days; i++) {
                const separator = document.createElement('div');
                separator.className = 'timeline-separator';
                separator.style.left = (i / days * 100) + '%';
                barContainer.appendChild(separator);
            }
        }

        function generateWeeklyScale(startDate, endDate, scaleRow, barContainer) {
            const weeks = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24 * 7));
            
            for (let i = 0; i < weeks; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + (i * 7));
                
                // Create scale unit (centered between lines)
                const unit = document.createElement('div');
                unit.className = 'scale-unit';
                
                const label = document.createElement('div');
                label.className = 'scale-label';
                label.textContent = `W${i + 1}`;
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'scale-date';
                dateLabel.textContent = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                unit.appendChild(label);
                unit.appendChild(dateLabel);
                scaleRow.appendChild(unit);
            }

            // Create separator lines (one less than scale units)
            for (let i = 1; i < weeks; i++) {
                const separator = document.createElement('div');
                separator.className = 'timeline-separator';
                separator.style.left = (i / weeks * 100) + '%';
                barContainer.appendChild(separator);
            }
        }

        function generateMonthlyScale(startDate, endDate, scaleRow, barContainer) {
            let current = new Date(startDate);
            const months = [];
            
            // Calculate all months
            while (current <= endDate) {
                months.push(new Date(current));
                current.setMonth(current.getMonth() + 1);
            }
            
            const totalMonths = months.length;
            
            // Create scale units (centered between lines)
            months.forEach((date, i) => {
                const unit = document.createElement('div');
                unit.className = 'scale-unit';
                
                const label = document.createElement('div');
                label.className = 'scale-label';
                label.textContent = date.toLocaleDateString('en-US', { month: 'short' });
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'scale-date';
                dateLabel.textContent = date.getFullYear();
                
                unit.appendChild(label);
                unit.appendChild(dateLabel);
                scaleRow.appendChild(unit);
            });

            // Create separator lines (one less than scale units)
            for (let i = 1; i < totalMonths; i++) {
                const separator = document.createElement('div');
                separator.className = 'timeline-separator';
                separator.style.left = (i / totalMonths * 100) + '%';
                barContainer.appendChild(separator);
            }
        }

        function generateQuarterlyScale(startDate, endDate, scaleRow, barContainer) {
            let current = new Date(startDate);
            const quarters = [];
            
            // Calculate all quarters
            while (current <= endDate) {
                quarters.push(new Date(current));
                current.setMonth(current.getMonth() + 3);
            }
            
            const totalQuarters = quarters.length;
            
            // Create scale units (centered between lines)
            quarters.forEach((date, i) => {
                const unit = document.createElement('div');
                unit.className = 'scale-unit';
                
                const quarter = Math.floor(date.getMonth() / 3) + 1;
                
                const label = document.createElement('div');
                label.className = 'scale-label';
                label.textContent = `Q${quarter}`;
                
                const dateLabel = document.createElement('div');
                dateLabel.className = 'scale-date';
                dateLabel.textContent = date.getFullYear();
                
                unit.appendChild(label);
                unit.appendChild(dateLabel);
                scaleRow.appendChild(unit);
            });

            // Create separator lines (one less than scale units)
            for (let i = 1; i < totalQuarters; i++) {
                const separator = document.createElement('div');
                separator.className = 'timeline-separator';
                separator.style.left = (i / totalQuarters * 100) + '%';
                barContainer.appendChild(separator);
            }
        }

        function updateStats(startDate, endDate, today, scale) {
            // Reset today to start of day for stats calculation
            const todayMidnight = new Date(today);
            todayMidnight.setHours(0, 0, 0, 0);
            
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const daysPassed = Math.max(0, Math.min(totalDays, Math.ceil((todayMidnight - startDate) / (1000 * 60 * 60 * 24))));
            const daysLeft = Math.max(0, totalDays - daysPassed);
            const percentComplete = Math.round((daysPassed / totalDays) * 100);

            let unit, totalUnits, unitsLeft;

            if (scale === 'daily') {
                unit = 'Day';
                totalUnits = totalDays;
                unitsLeft = daysLeft;
            } else if (scale === 'weekly') {
                unit = 'Week';
                totalUnits = Math.ceil(totalDays / 7);
                unitsLeft = Math.ceil(daysLeft / 7);
            } else if (scale === 'monthly') {
                unit = 'Month';
                totalUnits = Math.ceil(totalDays / 30);
                unitsLeft = Math.ceil(daysLeft / 30);
            } else if (scale === 'quarterly') {
                unit = 'Quarter';
                totalUnits = Math.ceil(totalDays / 90);
                unitsLeft = Math.ceil(daysLeft / 90);
            }

            document.getElementById('totalUnits').textContent = totalUnits;
            document.getElementById('totalUnitsLabel').textContent = `Total ${unit}${totalUnits !== 1 ? 's' : ''}`;
            document.getElementById('percentComplete').textContent = percentComplete + '%';
            document.getElementById('unitsLeft').textContent = unitsLeft;
            document.getElementById('unitsLeftLabel').textContent = `${unit}${unitsLeft !== 1 ? 's' : ''} Left`;
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function adjustBrightness(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        function copyLink() {
            const shareUrl = document.getElementById('shareUrl');
            shareUrl.select();
            shareUrl.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(shareUrl.value);
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }

        function resetForm() {
            const today = new Date();
            const threeMonthsLater = new Date(today);
            threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);
            
            document.getElementById('titleInput').value = '';
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('endDate').value = threeMonthsLater.toISOString().split('T')[0];
            document.getElementById('scale').value = 'weekly';
            document.getElementById('bgColor').value = '#f5f5f7';
            document.getElementById('barColor').value = '#007AFF';
            document.getElementById('todayColor').value = '#FF3B30';
            document.getElementById('timelineDisplay').style.display = 'none';
            
            window.history.pushState({}, '', window.location.pathname);
        }

        function cycleCardSize() {
            const card = document.getElementById('timelineCard');
            const indicator = document.getElementById('sizeIndicator');
            
            // Get current size or default to medium
            let currentSize = card.getAttribute('data-size') || 'medium';
            
            // Cycle through sizes: medium -> large -> small -> medium
            let newSize;
            if (currentSize === 'medium') {
                newSize = 'large';
            } else if (currentSize === 'large') {
                newSize = 'small';
            } else {
                newSize = 'medium';
            }
            
            // Remove all size classes
            card.classList.remove('size-small', 'size-medium', 'size-large');
            
            // Add new size class
            card.classList.add('size-' + newSize);
            card.setAttribute('data-size', newSize);
            
            // Update indicator text
            indicator.textContent = newSize.charAt(0).toUpperCase() + newSize.slice(1);
            
            // Save to URL if timeline is displayed
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('title')) {
                urlParams.set('size', newSize);
                const newUrl = window.location.pathname + '?' + urlParams.toString();
                window.history.replaceState({}, '', newUrl);
            }
        }

        // Load size from URL on page load
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const size = urlParams.get('size');
            if (size && ['small', 'medium', 'large'].includes(size)) {
                const card = document.getElementById('timelineCard');
                const indicator = document.getElementById('sizeIndicator');
                card.classList.add('size-' + size);
                card.setAttribute('data-size', size);
                indicator.textContent = size.charAt(0).toUpperCase() + size.slice(1);
            } else {
                // Default to medium
                document.getElementById('timelineCard').classList.add('size-medium');
                document.getElementById('timelineCard').setAttribute('data-size', 'medium');
            }
        });

        // Auto-refresh every hour to keep "today" accurate
        setInterval(() => {
            if (document.getElementById('timelineDisplay').style.display !== 'none') {
                generateTimeline();
            }
        }, 3600000); // 1 hour
    </script>
</body>
</html>
